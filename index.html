<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pig Love Poop - ÊµÅÁïÖÊö¥Ëµ∞Áâà</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');

        body {
            margin: 0; overflow: hidden; background-color: #000;
            font-family: 'Fredoka One', cursive, sans-serif;
            touch-action: none; user-select: none;
        }

        #game-container {
            position: relative; width: 100vw; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            background: #1a1a2e; overflow: hidden;
        }

        canvas { width: 100%; height: 100%; object-fit: contain; }

        /* UI Â±Ç */
        .ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; padding: 20px; box-sizing: border-box;
            display: flex; flex-direction: column; justify-content: space-between;
            z-index: 50;
        }

        .header {
            display: flex; justify-content: space-between; width: 100%; align-items: flex-start;
        }

        .score-box {
            background: rgba(255,255,255,0.9); border: 4px solid #ff9ff3; border-radius: 15px;
            padding: 10px 20px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .score-val { font-size: 32px; color: #2d3436; line-height: 1; }
        .level-val { font-size: 14px; color: #666; }

        /* ÈùôÈü≥ÊåâÈíÆ */
        .mute-btn {
            pointer-events: auto; background: rgba(0,0,0,0.5); border: 3px solid white;
            color: white; width: 60px; height: 60px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 30px; cursor: pointer; transition: 0.2s; box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .mute-btn:active { transform: scale(0.9); }

        /* ÁªèÈ™åÊù° */
        .xp-bar-container {
            width: 100%; height: 15px; background: rgba(0,0,0,0.6);
            position: absolute; bottom: 0; left: 0; border-top: 2px solid rgba(255,255,255,0.5);
        }
        .xp-fill {
            height: 100%; width: 0%; background: linear-gradient(90deg, #f1c40f, #e67e22);
            transition: width 0.2s;
        }

        /* ÂêØÂä®È°µ */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; transition: opacity 0.5s;
        }
        h1 {
            font-size: 5rem; color: white; margin: 0; text-shadow: 0 0 20px #ff9ff3;
            z-index: 2; text-align: center;
        }
        .btn-start {
            margin-top: 50px; background: transparent; color: white; border: 3px solid white;
            padding: 15px 60px; font-size: 2rem; cursor: pointer; z-index: 2; border-radius: 50px;
            font-weight: bold;
        }
        .btn-start:hover { background: white; color: black; }
        #loading-text { margin-top: 20px; color: #aaa; font-size: 16px; }

        /* ÊèêÁ§∫ */
        #toast {
            position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #ff9ff3, #feca57); padding: 15px 40px; border-radius: 40px;
            color: white; font-size: 30px; border: 4px solid #fff; opacity: 0; transition: all 0.4s; z-index: 60;
            text-align: center; white-space: nowrap; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        #toast.show { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        
        /* ÁâπÊïàÂ±Ç */
        #fx-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; mix-blend-mode: overlay; z-index: 20;
        }
        .dizzy { backdrop-filter: blur(5px) hue-rotate(90deg); }

    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div id="fx-layer"></div>

        <div class="ui-layer" id="uiLayer" style="opacity:0">
            <div class="header">
                <div class="score-box">
                    <div class="score-val" id="scoreVal">0</div>
                    <div class="level-val" id="levelVal">Lv.1 ÂÜúÂú∫</div>
                </div>
                <div class="mute-btn" onclick="toggleMute()" id="muteBtn">üîä</div>
            </div>
            <div class="xp-bar-container">
                <div class="xp-fill" id="xpFill"></div>
            </div>
        </div>

        <div id="toast">LEVEL UP!</div>

        <div id="start-screen">
            <h1>pig love poop</h1>
            <button class="btn-start" id="startBtn" onclick="startGame()">LOADING...</button>
            <div id="loading-text">ËµÑÊ∫êÂä†ËΩΩ‰∏≠...</div>
        </div>
    </div>

    <script>
        /* ================= ÈÖçÁΩÆÂå∫ ================= */
        const PATHS = {
            pig:       "assets/pig.png",
            poop:      "assets/poop.png",
            bg_farm:   "assets/bg_farm.png",
            bg_road:   "assets/bg_road.png",
            bg_bikini: "assets/bg_bikini.png",
            bg_cotton: "assets/bg_cotton.png",
            bg_moon:   "assets/bg_moon.png",
            music_1:   "assets/music_1.mp3",
            music_2:   "assets/music_2.mp3"
        };

        const LEVEL_CONFIG = {
            farm:   { max: 5,  xp: 10 },
            road:   { max: 10, xp: 15 },
            bikini: { max: 15, xp: 20 }, 
            cotton: { max: 20, xp: 25 }, 
            moon:   { max: 99, xp: 50 } 
        };

        const BACKUP_SVG = {
            pig: `data:image/svg+xml;utf8,${encodeURIComponent('<svg width="120" height="90" xmlns="http://www.w3.org/2000/svg"><ellipse cx="60" cy="50" rx="50" ry="35" fill="pink"/><circle cx="45" cy="40" r="5" fill="black"/><circle cx="75" cy="40" r="5" fill="black"/><ellipse cx="60" cy="60" rx="12" ry="8" fill="#ff6b6b"/></svg>')}`,
            poop: `data:image/svg+xml;utf8,${encodeURIComponent('<svg width="80" height="80" xmlns="http://www.w3.org/2000/svg"><path d="M40,70 C20,70 10,60 10,40 C10,20 30,10 40,5 C50,10 70,20 70,40 C70,60 60,70 40,70 Z" fill="FILL_COLOR"/><circle cx="30" cy="40" r="4" fill="white"/><circle cx="30" cy="40" r="2" fill="black"/><circle cx="50" cy="40" r="4" fill="white"/><circle cx="50" cy="40" r="2" fill="black"/></svg>')}`
        };

        // ================= ËµÑÊ∫êÂä†ËΩΩ =================
        const IMAGES = { bg: {}, poops: {} };
        const AUDIO = { bgm1: null, bgm2: null, current: null, isMuted: false };
        let loadedCount = 0;

        function checkLoad() {
            loadedCount++;
            document.getElementById('loading-text').innerText = `Âä†ËΩΩËµÑÊ∫ê (${loadedCount}/5)`;
            if(loadedCount >= 4) {
                const btn = document.getElementById('startBtn');
                btn.innerText = "START";
                btn.onclick = startGame;
                document.getElementById('loading-text').style.display = 'none';
            }
        }

        function loadImg(src, backup) {
            const img = new Image();
            img.onload = checkLoad;
            img.onerror = () => { console.log("‰ΩøÁî®Â§á‰ªΩ:", src); img.src = backup; checkLoad(); };
            img.src = src;
            return img;
        }

        IMAGES.pig = loadImg(PATHS.pig, BACKUP_SVG.pig);
        
        const basePoop = new Image();
        basePoop.onload = () => { IMAGES.poop = basePoop; checkLoad(); };
        basePoop.onerror = () => {
            const colors = { normal:'#8B5E3C', speed:'#0984e3', boom:'#e74c3c', gold:'#f1c40f', stinky:'#00b894', sticky:'#6c5ce7' };
            for(let k in colors) {
                IMAGES.poops[k] = new Image();
                IMAGES.poops[k].src = BACKUP_SVG.poop.replace('FILL_COLOR', colors[k]);
            }
            IMAGES.useSVG = true;
            checkLoad();
        };
        basePoop.src = PATHS.poop;

        ['farm','road','bikini','cotton','moon'].forEach(k => {
            IMAGES.bg[k] = loadImg(PATHS['bg_'+k], ""); 
        });

        AUDIO.bgm1 = new Audio(PATHS.music_1); AUDIO.bgm1.loop = true;
        AUDIO.bgm2 = new Audio(PATHS.music_2); AUDIO.bgm2.loop = true;

        // ================= Ê∏∏ÊàèÈÄªËæë =================
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const G_W = 1920, G_H = 1080;

        let state = {
            active: false,
            score: 0, level: 1, xp: 0, maxXp: 10,
            pig: { x: G_W/2, y: G_H/2, vx:0, vy:0, faceLeft:false, buffs:{} },
            poops: [], particles: [], 
            poopRainMode: false, poopRainTimer: 0,
            keys: { w:false, a:false, s:false, d:false },
            mouse: { x:0, y:0, active:false }
        };

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        window.addEventListener('keydown', e => state.keys[e.key.toLowerCase()] = true);
        window.addEventListener('keyup', e => state.keys[e.key.toLowerCase()] = false);
        canvas.addEventListener('pointerdown', e => { 
            state.mouse.active=true; updateMouse(e); 
            if(!AUDIO.isMuted && AUDIO.current && AUDIO.current.paused) AUDIO.current.play();
        });
        canvas.addEventListener('pointermove', e => { if(state.mouse.active) updateMouse(e); });
        canvas.addEventListener('pointerup', () => state.mouse.active=false);

        function updateMouse(e) {
            let s = Math.min(canvas.width/G_W, canvas.height/G_H) || 1;
            let dx = (canvas.width - G_W*s)/2;
            let dy = (canvas.height - G_H*s)/2;
            state.mouse.x = (e.clientX - dx)/s;
            state.mouse.y = (e.clientY - dy)/s;
        }

        function playMusic(id) {
            if(AUDIO.isMuted) return;
            let target = id===1 ? AUDIO.bgm1 : AUDIO.bgm2;
            let other = id===1 ? AUDIO.bgm2 : AUDIO.bgm1;
            if(AUDIO.current !== target) {
                other.pause(); other.currentTime = 0;
                target.volume = 0.5;
                target.play().catch(e=>{});
                AUDIO.current = target;
            }
        }

        function toggleMute() {
            AUDIO.isMuted = !AUDIO.isMuted;
            document.getElementById('muteBtn').innerText = AUDIO.isMuted ? 'üîá' : 'üîä';
            if(AUDIO.isMuted && AUDIO.current) AUDIO.current.pause();
            else if(AUDIO.current) AUDIO.current.play();
        }

        function startGame() {
            state.active = true;
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('uiLayer').style.opacity = 1;
            playMusic(1);
            loop();
            spawner();
        }

        function loop() {
            if(!state.active) return;
            update();
            draw();
            requestAnimationFrame(loop);
        }

        function update() {
            const scene = getScene();

            // 1. Áå™ÁßªÂä®
            let speed = 12 + (state.level * 0.5);
            
            // --- ÊúàÁêÉÂä†ÈÄü ---
            if(scene === 'moon') speed = 35; // ÈÄüÂ∫¶ÊûÅÂø´

            if(state.pig.buffs.speed > 0) { speed *= 2; state.pig.buffs.speed--; }
            if(state.pig.buffs.slow > 0) { speed *= 0.5; state.pig.buffs.slow--; }
            if(state.pig.buffs.dizzy > 0) { 
                state.pig.buffs.dizzy--; 
                state.pig.vx += (Math.random()-0.5)*5; state.pig.vy += (Math.random()-0.5)*5; 
            }

            let ax=0, ay=0;
            if(state.keys.w) ay = -1; if(state.keys.s) ay = 1;
            if(state.keys.a) ax = -1; if(state.keys.d) ax = 1;
            if(state.mouse.active) {
                let ang = Math.atan2(state.mouse.y - state.pig.y, state.mouse.x - state.pig.x);
                ax = Math.cos(ang); ay = Math.sin(ang);
            }

            state.pig.vx += ax * 2.5; state.pig.vy += ay * 2.5;
            state.pig.vx *= 0.92; state.pig.vy *= 0.92;

            let v = Math.hypot(state.pig.vx, state.pig.vy);
            if(v > speed) { state.pig.vx = (state.pig.vx/v)*speed; state.pig.vy = (state.pig.vy/v)*speed; }

            if(isNaN(state.pig.x)) state.pig.x = G_W/2;
            if(isNaN(state.pig.y)) state.pig.y = G_H/2;

            state.pig.x += state.pig.vx; state.pig.y += state.pig.vy;

            if(state.pig.x < 50) state.pig.x = 50; if(state.pig.x > G_W-50) state.pig.x = G_W-50;
            if(state.pig.y < 50) state.pig.y = 50; if(state.pig.y > G_H-50) state.pig.y = G_H-50;
            
            if(state.pig.vx < -0.5) state.pig.faceLeft = false;
            if(state.pig.vx > 0.5) state.pig.faceLeft = true;

            // 2. Â±éÈÄªËæë
            if(state.poopRainMode) {
                state.poopRainTimer--;
                if(state.poopRainTimer <= 0) state.poopRainMode = false;
            }

            for(let i=state.poops.length-1; i>=0; i--) {
                let p = state.poops[i];
                if(p.scale < 1) p.scale += 0.05;
                
                // Á£ÅÈìÅÂê∏ÈôÑ
                if(state.level >= 5 && p.type!=='stinky' && p.type!=='sticky') {
                    let d = Math.hypot(p.x - state.pig.x, p.y - state.pig.y);
                    let suckRange = 400;
                    let suckSpeed = 0.1;
                    if (scene === 'moon') { suckRange = 600; suckSpeed = 0.3; } // ÊúàÁêÉË∂ÖÁ∫ßÂê∏ÈôÑ

                    if(d < suckRange) {
                        p.x += (state.pig.x - p.x) * suckSpeed;
                        p.y += (state.pig.y - p.y) * suckSpeed;
                    }
                }

                // Á¢∞ÊíûËåÉÂõ¥
                let hitR = 100 + state.level;
                if(p.type === 'giant') hitR = 200;
                
                if(Math.hypot(p.x - state.pig.x, p.y - state.pig.y) < hitR) {
                    eat(p, i);
                }
            }

            // 3. Á≤íÂ≠ê
            for(let i=state.particles.length-1; i>=0; i--) {
                state.particles[i].x += state.particles[i].vx;
                state.particles[i].y += state.particles[i].vy;
                state.particles[i].life -= 0.05;
                if(state.particles[i].life <= 0) state.particles.splice(i, 1);
            }
        }

        function eat(p, idx) {
            state.poops.splice(idx, 1);
            let val = 1; let scoreAdd = 10;
            let color = "#8B5E3C";

            if(p.type === 'gold') { val=3; scoreAdd=50; color='#f1c40f'; }
            if(p.type === 'giant') { val=10; scoreAdd=500; color='#f1c40f'; }
            if(p.type === 'speed') { state.pig.buffs.speed = 300; color='#0984e3'; showMsg("‚ö° Âä†ÈÄü!"); }
            if(p.type === 'boom') { 
                color='#e74c3c'; createExplosion(p.x, p.y);
                state.poops.forEach(o => {
                    if(Math.hypot(o.x-state.pig.x, o.y-state.pig.y)<800) { o.x=state.pig.x; o.y=state.pig.y; }
                });
                showMsg("üí• ÁÇ∏Ë£Ç!");
            }
            if(p.type === 'stinky') { state.pig.buffs.dizzy = 120; color='#00b894'; if(state.level < 10) showMsg("ü§¢ Â•ΩÊôï!"); }
            if(p.type === 'sticky') { state.pig.buffs.slow = 120; color='#6c5ce7'; showMsg("üï∏Ô∏è Èªè‰Ωè!"); }

            state.xp += val; state.score += scoreAdd;
            
            // ÂáèÂ∞ëÁ≤íÂ≠êÁîüÊàêÊï∞ÈáèÔºåÈò≤Ê≠¢Âç°È°ø
            for(let k=0; k<3; k++) {
                state.particles.push({
                    x:p.x, y:p.y, vx:(Math.random()-0.5)*15, vy:(Math.random()-0.5)*15, life:1, color:color
                });
            }

            if(state.xp >= state.maxXp) levelUp();
            updateUI();
        }

        function levelUp() {
            state.level++; state.xp = 0;
            let conf = getLevelConfig(); state.maxXp = conf.xp;

            if(state.level===6) showMsg("Êñ∞Âú∫ÊôØ: ÂÖ¨Ë∑Ø!");
            if(state.level===11) showMsg("Êñ∞Âú∫ÊôØ: ÊØîÂ•áÂ†°!");
            if(state.level===16) showMsg("Êñ∞Âú∫ÊôØ: Ê∏∏‰πêÂõ≠!");
            if(state.level===21) { showMsg("ËøõÂÖ•ÊúàÁêÉ!", "ÂºïÂäõÂºÇÂ∏∏!"); playMusic(2); }
            else showMsg("LEVEL UP!");
        }

        function spawner() {
            if(!state.active) return;
            
            let scene = getScene();
            let delay = 300; // Âü∫Á°ÄÁîüÊàêÈÄüÂ∫¶Âä†Âø´
            
            if(scene === 'moon') delay = 50; // ÊúàÁêÉË∂ÖÂø´ÁîüÊàê
            if(state.poopRainMode) delay = 20; // Â§ß‰æøÈõ®ÊûÅÈÄü

            setTimeout(() => {
                spawn();
                spawner();
            }, delay);
        }

        function spawn() {
            let scene = getScene();
            let max = 30 + state.level * 2;
            
            if(scene === 'moon') max = 200; // ÊúàÁêÉÂêåÂ±è‰∏äÈôê 200ÔºåÈò≤Ê≠¢Âç°Ê≠ª
            if(state.poopRainMode) max = 250;
            
            if(state.poops.length >= max) return;

            // ÈöèÊú∫‰∫ã‰ª∂
            if(!state.poopRainMode && Math.random()<0.005) { 
                state.poopRainMode=true; state.poopRainTimer=400; showMsg("üí© Â§ß‰æøÈõ®Êù•Ë¢≠!", "ÁãÇÊ¨¢Êó∂Âàª!"); 
            }
            
            let type='normal'; let r=Math.random();
            if(r<0.02) type='giant'; else if(r<0.07) type='speed'; else if(r<0.12) type='boom';
            else if(r<0.17) type='gold'; else if(r<0.22) type='stinky'; else if(r<0.27) type='sticky';

            state.poops.push({
                x: Math.random()*(G_W-100)+50, y: Math.random()*(G_H-100)+50,
                type: type, scale: 0, float: Math.random()*100
            });
        }

        function createExplosion(x, y) {
            for(let i=0; i<15; i++) {
                state.particles.push({
                    x:x, y:y, vx:(Math.random()-0.5)*30, vy:(Math.random()-0.5)*30,
                    life:1.5, color:'#e74c3c'
                });
            }
        }

        function getScene() {
            if(state.level <= 5) return 'farm';
            if(state.level <= 10) return 'road';
            if(state.level <= 15) return 'bikini';
            if(state.level <= 20) return 'cotton';
            return 'moon';
        }

        function getLevelConfig() {
            if(state.level <= 5) return { xp: 10 };
            if(state.level <= 10) return { xp: 20 };
            if(state.level <= 15) return { xp: 30 };
            if(state.level <= 20) return { xp: 40 };
            return { xp: 100 };
        }

        function updateUI() {
            document.getElementById('scoreVal').innerText = state.score;
            let names = {farm:'ÂÜúÂú∫', road:'ÂÖ¨Ë∑Ø', bikini:'ÊØîÂ•áÂ†°', cotton:'Ê∏∏‰πêÂõ≠', moon:'ÊúàÁêÉ'};
            document.getElementById('levelVal').innerText = `Lv.${state.level} ${names[getScene()]}`;
            document.getElementById('xpFill').style.width = `${(state.xp/state.maxXp)*100}%`;
        }

        function showMsg(t, t2="") {
            const toast = document.getElementById('toast');
            toast.innerHTML = `<div>${t}</div><div style="font-size:16px">${t2}</div>`;
            toast.classList.add('show');
            setTimeout(()=>toast.classList.remove('show'), 1500);
        }

        function draw() {
            let s = Math.min(canvas.width/G_W, canvas.height/G_H) || 1;
            let dx = (canvas.width - G_W*s)/2;
            let dy = (canvas.height - G_H*s)/2;

            ctx.fillStyle = "#000"; ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.save(); ctx.translate(dx, dy); ctx.scale(s, s);
            ctx.beginPath(); ctx.rect(0,0,G_W,G_H); ctx.clip();

            const scene = getScene();
            let bg = IMAGES.bg[scene];

            // 1. ËÉåÊôØ
            if(bg && bg.complete && bg.naturalWidth!==0) {
                ctx.drawImage(bg, 0, 0, G_W, G_H);
            } else {
                ctx.fillStyle = (scene==='moon') ? "#2c3e50" : "#78e08f"; ctx.fillRect(0,0,G_W,G_H);
            }

            // 2. Â±é
            let useFilter = (scene !== 'moon'); // ÊúàÁêÉÂÖ≥Âç°ÂÖ≥Èó≠Êª§Èïú‰ª•ÊèêÂçáÊÄßËÉΩ
            
            state.poops.forEach(p => {
                let hover = Math.sin((Date.now()/200)+p.float) * 5;
                ctx.save(); ctx.translate(p.x, p.y + hover);
                let sc = p.type === 'giant' ? 3 : 1;
                ctx.scale(p.scale * sc, p.scale * sc);

                if(useFilter && !IMAGES.useSVG) {
                    if(p.type === 'speed') ctx.filter = "hue-rotate(200deg)"; 
                    else if(p.type === 'boom') ctx.filter = "hue-rotate(320deg)";
                    else if(p.type === 'stinky') ctx.filter = "hue-rotate(120deg)";
                    else if(p.type === 'sticky') ctx.filter = "hue-rotate(260deg)";
                    else if(p.type === 'gold' || p.type === 'giant') ctx.filter = "sepia(100%) brightness(1.5)";
                }

                ctx.fillStyle = "rgba(0,0,0,0.2)"; ctx.beginPath(); ctx.ellipse(0, 35, 30, 10, 0,0,Math.PI*2); ctx.fill();

                let drawImg = IMAGES.poop;
                if(IMAGES.useSVG) drawImg = IMAGES.poops[p.type] || IMAGES.poops.normal;

                if(drawImg && drawImg.complete && drawImg.naturalWidth!==0) {
                    ctx.drawImage(drawImg, -40, -40, 80, 80);
                } else {
                    ctx.fillStyle = "brown"; ctx.beginPath(); ctx.arc(0,0,40,0,Math.PI*2); ctx.fill();
                }
                ctx.restore();
            });

            // 3. Áå™ (Â§ßÂ∞∫ÂØ∏: 320x240)
            ctx.save(); ctx.translate(state.pig.x, state.pig.y);
            let pScale = 1 + (state.level * 0.05);
            if(state.pig.faceLeft) ctx.scale(-pScale, pScale); else ctx.scale(pScale, pScale);

            // ÂΩ±Â≠ê
            ctx.fillStyle = "rgba(0,0,0,0.3)"; 
            ctx.beginPath(); ctx.ellipse(0, 100, 100, 25, 0,0,Math.PI*2); ctx.fill();

            if(IMAGES.pig.complete && IMAGES.pig.naturalWidth!==0) {
                // ÂÆΩ320ÔºåÈ´ò240 (Â±Ö‰∏≠ÁªòÂà∂)
                ctx.drawImage(IMAGES.pig, -160, -120, 320, 240);
            } else {
                ctx.fillStyle = "pink"; ctx.fillRect(-100, -80, 200, 160);
            }
            ctx.restore();

            // 4. Á≤íÂ≠ê
            state.particles.forEach(pt => {
                ctx.globalAlpha = pt.life; ctx.fillStyle = pt.color || "white";
                ctx.beginPath(); ctx.arc(pt.x, pt.y, 8, 0, Math.PI*2); ctx.fill();
            });
            ctx.globalAlpha = 1;

            const fx = document.getElementById('fx-layer');
            if(state.pig.buffs.dizzy > 0) fx.className = 'dizzy';
            else fx.className = '';

            ctx.restore();
        }
    </script>
</body>
</html>